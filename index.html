<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpendWise Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root { --primary: #6366f1; --success: #10b981; --danger: #ef4444; --text-main: #334155; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; color: var(--text-main); }
        .app-container { max-width: 800px; margin: auto; background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); overflow: hidden; }
        
        .login-view { padding: 40px 20px; text-align: center; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        
        .header { background: #fff; padding: 20px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; }
        .stat-box { text-align: center; flex: 1; }
        .stat-label { font-size: 12px; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; }
        .stat-value { font-size: 20px; font-weight: bold; display: block; }

        .form-section { padding: 20px; background: #fdfdfd; border-bottom: 1px solid #f1f5f9; }
        .btn { padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 10px; transition: 0.2s; }
        .btn-add { background: var(--primary); color: white; }
        
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; background: white; min-width: 600px; }
        th { background: #f8fafc; color: #64748b; font-size: 12px; text-transform: uppercase; padding: 15px 10px; text-align: left; border-bottom: 1px solid #f1f5f9; }
        td { padding: 15px 10px; border-bottom: 1px solid #f8fafc; font-size: 14px; }
        
        .type-income { color: var(--success); font-weight: bold; }
        .type-spend { color: var(--danger); font-weight: bold; }
        .btn-delete { color: var(--danger); font-weight: bold; cursor: pointer; background: none; border: none; }
        
        .hidden { display: none; }
        .item-row { display: flex; gap: 10px; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="login-view" class="login-view">
        <h2 style="color: var(--primary)">SpendWise Login</h2>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button class="btn btn-add" onclick="login()">Login</button>
    </div>

    <div id="main-view" class="hidden">
        <div class="header">
            <div class="stat-box">
                <span class="stat-label">Current Balance</span>
                <span class="stat-value" id="top-bal">₹0</span>
            </div>
            <div class="stat-box" style="border-left: 1px solid #f1f5f9;">
                <span class="stat-label">Total Spent</span>
                <span class="stat-value" style="color: var(--danger)" id="top-spent">₹0</span>
            </div>
            <div style="padding-left: 15px; text-align: right;">
                <div style="font-size: 11px; font-weight: bold;" id="user-display"></div>
                <button onclick="location.reload()" style="font-size: 10px; margin-top: 5px; cursor: pointer;">Logout</button>
            </div>
        </div>

        <div class="form-section">
            <input type="date" id="entry-date">
            <div id="item-inputs"></div>
            <button onclick="addItemRow()" style="background:none; border:none; color:var(--primary); cursor:pointer; font-size:13px; font-weight:bold;">+ Add Item</button>
            
            <select id="entry-type">
                <option value="spend">SPEND</option>
                <option value="income">INCOME</option>
            </select>
            <button class="btn btn-add" onclick="saveEntry()">Record Entry</button>
            <button onclick="exportPDF()" style="background: #475569; color:white; margin-top: 10px; border-radius: 8px; border:none; padding:10px; width:100%; cursor:pointer;">Download PDF Report</button>
            <button onclick="resetData()" style="background:none; border:none; color:var(--danger); width:100%; margin-top:10px; cursor:pointer; font-size:12px;">Refresh All Data</button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>DATE</th>
                        <th>DETAILS</th>
                        <th>TYPE</th>
                        <th>AMOUNT</th>
                        <th>BALANCE</th>
                        <th>ACTION</th>
                    </tr>
                </thead>
                <tbody id="table-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const users = { "Gundu": "hari", "Srividhyalakshmi": "sriluxee","Kaushika":"kaushikavimal" };
    let currentUser = "";
    let entries = [];

    function login() {
        const u = document.getElementById('username').value;
        const p = document.getElementById('password').value;
        if(users[u] === p) {
            currentUser = u;
            document.getElementById('login-view').classList.add('hidden');
            document.getElementById('main-view').classList.remove('hidden');
            document.getElementById('user-display').innerText = u;
            document.getElementById('entry-date').valueAsDate = new Date();
            entries = JSON.parse(localStorage.getItem('my_spends_' + currentUser)) || [];
            addItemRow();
            render();
        } else { alert("Wrong credentials"); }
    }

    function addItemRow() {
        const container = document.getElementById('item-inputs');
        const div = document.createElement('div');
        div.className = 'item-row';
        div.innerHTML = `<input type="text" placeholder="Item Name" class="i-name" style="flex:2">
                         <input type="number" placeholder="₹" class="i-price" style="flex:1">`;
        container.appendChild(div);
    }

    function saveEntry() {
        const date = document.getElementById('entry-date').value;
        const type = document.getElementById('entry-type').value;
        let total = 0;
        let details = [];

        document.querySelectorAll('.item-row').forEach(row => {
            const name = row.querySelector('.i-name').value;
            const price = parseFloat(row.querySelector('.i-price').value);
            if(price) {
                total += price;
                if(name) details.push(name);
            }
        });

        if(total <= 0) return alert("Enter amount");

        entries.push({ date, details: details.join(", "), type, amt: total });
        localStorage.setItem('my_spends_' + currentUser, JSON.stringify(entries));
        
        document.getElementById('item-inputs').innerHTML = "";
        addItemRow();
        render();
    }

    function render() {
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = "";
        let runningBal = 0;
        let totalSpent = 0;

        entries.sort((a,b) => new Date(a.date) - new Date(b.date));

        entries.forEach((item, index) => {
            if(item.type === 'income') runningBal += item.amt;
            else { runningBal -= item.amt; totalSpent += item.amt; }

            // Add balance to entry object for PDF export later
            item.currentRunningBalance = runningBal;

            const row = `<tr>
                <td>${item.date}</td>
                <td style="color:#64748b;">${item.details}</td>
                <td class="type-${item.type}">${item.type.toUpperCase()}</td>
                <td>₹${item.amt}</td>
                <td>₹${runningBal}</td>
                <td><button class="btn-delete" onclick="deleteEntry(${index})">Delete</button></td>
            </tr>`;
            tbody.insertAdjacentHTML('afterbegin', row);
        });

        document.getElementById('top-bal').innerText = "₹" + runningBal;
        document.getElementById('top-spent').innerText = "₹" + totalSpent;
    }

    function deleteEntry(index) {
        if(confirm("Delete this record?")) {
            entries.splice(index, 1);
            localStorage.setItem('my_spends_' + currentUser, JSON.stringify(entries));
            render();
        }
    }

    function resetData() {
        if(confirm("This will delete everything. Are you sure?")) {
            localStorage.removeItem('my_spends_' + currentUser);
            entries = [];
            render();
        }
    }

    function exportPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Header matching your screenshot
        doc.setFontSize(22);
        doc.text(`Expense Report: ${currentUser}`, 15, 20);
        doc.setFontSize(10);
        doc.text(`Generated on: ${new Date().toLocaleDateString('en-GB')}`, 15, 30);

        // Sorting for PDF consistency
        entries.sort((a,b) => new Date(a.date) - new Date(b.date));

        // Data including Balance column
        const rows = entries.map(e => [
            e.date, 
            e.details, 
            e.type.toUpperCase(), 
            `Rs. ${e.amt}`, 
            `Rs. ${e.currentRunningBalance}`
        ]);

        doc.autoTable({
            head: [['Date', 'Description', 'Type', 'Amount', 'Balance']],
            body: rows,
            startY: 40,
            theme: 'grid',
            headStyles: { fillColor: [99, 102, 241], textColor: [255, 255, 255] }, // Matching the purple header in your image
            styles: { fontSize: 9, cellPadding: 3 }
        });

        doc.save(`Expense_Report_${currentUser}.pdf`);
    }
</script>
</body>
</html>

